---
groups:
  - name: RabbitMQ
    rules:
      - alert: RabbitMQDown
        expr: rabbitmq_up == 0
        for: 3m
        labels:
          severity: critical
          env: "{{ $labels.env }}"
          group: "{{ $labels.group }}"
        annotations:
          summary: RabbitMQ {{ $labels.group }} {{ $labels.instance }} недоступен
          description: RabbitMQ на сервере {{ $labels.instance }} группы {{ $labels.group }} не отвечает более 3 минут
          grafana_url: "http://into.tcsbank.ru:3000/dashboard/db/rabbitmq-instance?from=now-30m&var-node={{ $labels.instance }}"
      - alert: RabbitMQExporterDown
        expr: up{job = "rabbitmq"} == 0
        for: 5m
        labels:
          severity: warning
          env: "{{ $labels.env }}"
          group: "{{ $labels.group }}"
        annotations:
          summary: Prometheus RabbitMQ Exporter {{ $labels.group }} {{ $labels.instance }} недоступен
          description: Prometheus RabbitMQ Exporter на сервере {{ $labels.instance }} группы {{ $labels.group }} не отвечает на HTTP-запросы Prometheus более 5 минут
          grafana_url: "http://into.tcsbank.ru:3000/dashboard/db/rabbitmq-instance?from=now-30m&var-node={{ $labels.instance }}"
      - alert: RabbitMQNotRunning
        expr: rabbitmq_running == 0
        for: 2m
        labels:
          severity: critical
          env: "{{ $labels.env }}"
          group: "{{ $labels.group }}"
        annotations:
          summary: У RabbitMQ {{ $labels.group }} {{ $labels.instance }} недоступна нода {{ $labels.node }}
          description: Нода {{ $labels.node }} кластера недоступна на сервере {{ $labels.instance }} группы {{ $labels.group }} более 2 минут
          grafana_url: "http://into.tcsbank.ru:3000/dashboard/db/rabbitmq-instance?from=now-30m&var-node={{ $labels.instance }}"

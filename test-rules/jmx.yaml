groups:
  - name: JMX
    rules:
      - alert: JMXScrapeError
        expr: jmx_scrape_error{env = "prod"} != 0
        for: 3m
        labels:
          severity: critical
          env: "{{ $labels.env }}"
          group: "{{ $labels.group }}"
          splunk_index: "{{ $labels.group }}"
        annotations:
          summary: Ошибки при запросе JMX URL {{ $labels.group }} {{ $labels.instance }}
          description: JMX URL на сервере {{ $labels.instance }} группы {{ $labels.group }} не отвечает или возвращает ошибки более 3 минут
      - alert: JMXExporterDown
        expr: up{job =~ "jmx-.+", env = "prod"} == 0
        for: 5m
        labels:
          severity: warning
          env: "{{ $labels.env }}"
          group: "{{ $labels.group }}"
          splunk_index: "{{ $labels.group }}"
        annotations:
          summary: Prometheus JMX Exporter {{ $labels.group }} {{ $labels.instance }} недоступен
          description: Prometheus JMX Exporter на сервере {{ $labels.instance }} группы {{ $labels.group }} не отвечает на HTTP-запросы Prometheus более 5 минут
      - alert: JMXScrapeDurationSeconds
        expr: jmx_scrape_duration_seconds{env = "prod"} > 0.5
        labels:
          severity: warning
          env: "{{ $labels.env }}"
          group: "{{ $labels.group }}"
          splunk_index: "{{ $labels.group }}"
        annotations:
          summary: JMX URL {{ $labels.group }} {{ $labels.instance }} отвечает слишком долго
          description: Время ответа JMX URL на сервере {{ $labels.instance }} группы {{ $labels.group }} превышает 500 мс.
